"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DirTree = void 0;
const tslib_1 = require("tslib");
const _ = tslib_1.__importStar(require("lodash"));
const Path = require("path");
class DirTree {
    constructor() {
        this.root = { map: {}, name: '' };
    }
    putRootData(data) {
        this.root.data = data;
    }
    getRootData() {
        return this.root.data;
    }
    putData(path, data) {
        if (!path) {
            this.putRootData(data);
            return;
        }
        var tree = this.ensureNode(path);
        tree.data = data;
    }
    getData(path) {
        if (!path) {
            return this.getRootData();
        }
        var tree = this.findNode(path);
        return tree ? tree.data : null;
    }
    /**
     * @return Array of data
     */
    getAllData(path) {
        if (!Array.isArray(path)) {
            if (Path.sep === '\\')
                path = path.toLowerCase();
            return this.getAllData(path.split(/[/\\]/));
        }
        // if (path[0] === '')
        // 	path.shift();
        var tree = this.root;
        var datas = [];
        if (_.has(tree, 'data'))
            datas.push(tree.data);
        _.every(path, name => {
            if (_.has(tree, ['map', name])) {
                tree = tree.map[name];
                if (_.has(tree, 'data'))
                    datas.push(tree.data);
                return true;
            }
            // tree = null;
            return false;
        });
        return datas;
    }
    ensureNode(path) {
        if (!Array.isArray(path)) {
            if (Path.sep === '\\')
                path = path.toLowerCase();
            return this.ensureNode(path.split(/[/\\]/));
        }
        var tree = this.root;
        _.each(path, name => {
            if (_.has(tree, ['map', name])) {
                tree = tree.map[name];
            }
            else {
                var child = { map: {}, name };
                tree.map[name] = child;
                tree = child;
            }
        });
        return tree;
    }
    findNode(path) {
        if (!Array.isArray(path)) {
            if (Path.sep === '\\')
                path = path.toLowerCase();
            return this.findNode(path.split(/[/\\]/));
        }
        var tree = this.root;
        _.every(path, name => {
            if (_.has(tree, ['map', name])) {
                tree = tree.map[name];
                return true;
            }
            tree = null;
            return false;
        });
        return tree;
    }
    traverse(level = 0, tree, lines = []) {
        var isRoot = false;
        if (!level)
            level = 0;
        if (!tree)
            tree = this.root;
        if (!lines) {
            isRoot = true;
            lines = [];
        }
        var indent = _.repeat('│  ', level);
        lines.push(indent + '├─ ' + tree.name + (tree.data ? ' [x]' : ''));
        _.each(tree.map, (subTree, subNames) => {
            this.traverse(level + 1, subTree, lines);
        });
        return isRoot ? lines.join('\n') : lines;
    }
}
exports.DirTree = DirTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlyLXRyZWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi90cy9kaXItdHJlZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsa0RBQTRCO0FBQzVCLDZCQUE4QjtBQVM5QixNQUFhLE9BQU87SUFBcEI7UUFDQyxTQUFJLEdBQWdCLEVBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFDLENBQUM7SUE2R3pDLENBQUM7SUEzR0EsV0FBVyxDQUFDLElBQU87UUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxXQUFXO1FBQ1YsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN2QixDQUFDO0lBRUQsT0FBTyxDQUFDLElBQVksRUFBRSxJQUFPO1FBQzVCLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3ZCLE9BQU87U0FDUDtRQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbEIsQ0FBQztJQUVELE9BQU8sQ0FBQyxJQUFZO1FBQ25CLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUMxQjtRQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVLENBQUMsSUFBdUI7UUFDakMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDekIs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Q0FDRDtBQTlHRCwwQkE4R0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgUGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbi8vIGNvbnN0IG9zID0gcmVxdWlyZSgnb3MnKTtcbi8vIHZhciBpc1dpbjMyID0gb3MucGxhdGZvcm0oKS5pbmRleE9mKCd3aW4zMicpID49IDA7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlZU5vZGU8VD4ge1xuXHRtYXA6IHtbY2hpbGQ6IHN0cmluZ106IFRyZWVOb2RlPFQ+fTtcblx0bmFtZTogc3RyaW5nO1xuXHRkYXRhPzogVDtcbn1cbmV4cG9ydCBjbGFzcyBEaXJUcmVlPFQ+IHtcblx0cm9vdDogVHJlZU5vZGU8VD4gPSB7bWFwOiB7fSwgbmFtZTogJyd9O1xuXG5cdHB1dFJvb3REYXRhKGRhdGE6IFQpIHtcblx0XHR0aGlzLnJvb3QuZGF0YSA9IGRhdGE7XG5cdH1cblxuXHRnZXRSb290RGF0YSgpIHtcblx0XHRyZXR1cm4gdGhpcy5yb290LmRhdGE7XG5cdH1cblxuXHRwdXREYXRhKHBhdGg6IHN0cmluZywgZGF0YTogVCkge1xuXHRcdGlmICghcGF0aCkge1xuXHRcdFx0dGhpcy5wdXRSb290RGF0YShkYXRhKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIHRyZWUgPSB0aGlzLmVuc3VyZU5vZGUocGF0aCk7XG5cdFx0dHJlZS5kYXRhID0gZGF0YTtcblx0fVxuXG5cdGdldERhdGEocGF0aDogc3RyaW5nKTogVCB8IG51bGwgfCB1bmRlZmluZWQge1xuXHRcdGlmICghcGF0aCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0Um9vdERhdGEoKTtcblx0XHR9XG5cdFx0dmFyIHRyZWUgPSB0aGlzLmZpbmROb2RlKHBhdGgpO1xuXHRcdHJldHVybiB0cmVlID8gdHJlZS5kYXRhIDogbnVsbDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAcmV0dXJuIEFycmF5IG9mIGRhdGFcblx0ICovXG5cdGdldEFsbERhdGEocGF0aDogc3RyaW5nIHwgc3RyaW5nW10pOiBUW10ge1xuXHRcdGlmICghQXJyYXkuaXNBcnJheShwYXRoKSkge1xuXHRcdFx0aWYgKFBhdGguc2VwID09PSAnXFxcXCcpXG5cdFx0XHRcdHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRBbGxEYXRhKHBhdGguc3BsaXQoL1svXFxcXF0vKSk7XG5cdFx0fVxuXHRcdC8vIGlmIChwYXRoWzBdID09PSAnJylcblx0XHQvLyBcdHBhdGguc2hpZnQoKTtcblx0XHR2YXIgdHJlZSA9IHRoaXMucm9vdDtcblx0XHR2YXIgZGF0YXM6IFRbXSA9IFtdO1xuXHRcdGlmIChfLmhhcyh0cmVlLCAnZGF0YScpKVxuXHRcdFx0ZGF0YXMucHVzaCh0cmVlLmRhdGEhKTtcblx0XHRfLmV2ZXJ5KHBhdGgsIG5hbWUgPT4ge1xuXHRcdFx0aWYgKF8uaGFzKHRyZWUsIFsnbWFwJywgbmFtZV0pKSB7XG5cdFx0XHRcdHRyZWUgPSB0cmVlLm1hcFtuYW1lXTtcblx0XHRcdFx0aWYgKF8uaGFzKHRyZWUsICdkYXRhJykpXG5cdFx0XHRcdFx0ZGF0YXMucHVzaCh0cmVlLmRhdGEhKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHQvLyB0cmVlID0gbnVsbDtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZGF0YXM7XG5cdH1cblxuXHRlbnN1cmVOb2RlKHBhdGg6IHN0cmluZyB8IHN0cmluZ1tdKTogVHJlZU5vZGU8VD4ge1xuXHRcdGlmICghQXJyYXkuaXNBcnJheShwYXRoKSkge1xuXHRcdFx0aWYgKFBhdGguc2VwID09PSAnXFxcXCcpXG5cdFx0XHRcdHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcy5lbnN1cmVOb2RlKHBhdGguc3BsaXQoL1svXFxcXF0vKSk7XG5cdFx0fVxuXHRcdHZhciB0cmVlID0gdGhpcy5yb290O1xuXHRcdF8uZWFjaChwYXRoLCBuYW1lID0+IHtcblx0XHRcdGlmIChfLmhhcyh0cmVlLCBbJ21hcCcsIG5hbWVdKSkge1xuXHRcdFx0XHR0cmVlID0gdHJlZS5tYXBbbmFtZV07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR2YXIgY2hpbGQgPSB7bWFwOiB7fSwgbmFtZX07XG5cdFx0XHRcdHRyZWUubWFwW25hbWVdID0gY2hpbGQ7XG5cdFx0XHRcdHRyZWUgPSBjaGlsZDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXR1cm4gdHJlZTtcblx0fVxuXG5cdGZpbmROb2RlKHBhdGg6IHN0cmluZyB8IHN0cmluZ1tdKTogVHJlZU5vZGU8VD4gfCBudWxsIHtcblx0XHRpZiAoIUFycmF5LmlzQXJyYXkocGF0aCkpIHtcblx0XHRcdGlmIChQYXRoLnNlcCA9PT0gJ1xcXFwnKVxuXHRcdFx0XHRwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXMuZmluZE5vZGUocGF0aC5zcGxpdCgvWy9cXFxcXS8pKTtcblx0XHR9XG5cdFx0dmFyIHRyZWU6IFRyZWVOb2RlPFQ+IHwgbnVsbCA9IHRoaXMucm9vdDtcblx0XHRfLmV2ZXJ5KHBhdGgsIG5hbWUgPT4ge1xuXHRcdFx0aWYgKF8uaGFzKHRyZWUsIFsnbWFwJywgbmFtZV0pKSB7XG5cdFx0XHRcdHRyZWUgPSB0cmVlIS5tYXBbbmFtZV07XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0dHJlZSA9IG51bGw7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHRyZWU7XG5cdH1cblxuXHR0cmF2ZXJzZShsZXZlbCA9IDAsIHRyZWU/OiBUcmVlTm9kZTxUPiwgbGluZXM6IHN0cmluZ1tdID0gW10pIHtcblx0XHR2YXIgaXNSb290ID0gZmFsc2U7XG5cdFx0aWYgKCFsZXZlbClcblx0XHRcdGxldmVsID0gMDtcblx0XHRpZiAoIXRyZWUpXG5cdFx0XHR0cmVlID0gdGhpcy5yb290O1xuXHRcdGlmICghbGluZXMpIHtcblx0XHRcdGlzUm9vdCA9IHRydWU7XG5cdFx0XHRsaW5lcyA9IFtdO1xuXHRcdH1cblx0XHR2YXIgaW5kZW50ID0gXy5yZXBlYXQoJ+KUgiAgJywgbGV2ZWwpO1xuXHRcdGxpbmVzLnB1c2goaW5kZW50ICsgJ+KUnOKUgCAnICsgdHJlZS5uYW1lICsgKHRyZWUuZGF0YSA/ICcgW3hdJyA6ICcnKSk7XG5cdFx0Xy5lYWNoKHRyZWUubWFwLCAoc3ViVHJlZSwgc3ViTmFtZXMpID0+IHtcblx0XHRcdHRoaXMudHJhdmVyc2UobGV2ZWwgKyAxLCBzdWJUcmVlLCBsaW5lcyk7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIGlzUm9vdCA/IGxpbmVzLmpvaW4oJ1xcbicpIDogbGluZXM7XG5cdH1cbn1cbiJdfQ==